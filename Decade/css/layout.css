/**
 * layout.css
 * Main game container and structural layout
 * Defines the grid system for HUD, game area, and timeline
 */

/* =========================================
   APP & VIEWPORT (wrapper for responsive)
   ========================================= */

#app {
    display: flex;
    flex-direction: column;
    align-items: center;
}

#viewport {
    position: relative;
}

#controller-area {
    display: none;
}

/* =========================================
   GAME CONTAINER
   Main wrapper for entire game interface
   ========================================= */

#game-container {
    width: var(--game-width);
    height: var(--game-height);
    
    display: grid;
    grid-template-rows: var(--hud-height) 1fr var(--timeline-height);
    grid-template-areas:
        "hud"
        "game"
        "timeline";
    
    background: var(--color-bg-secondary);
    border: 4px solid var(--color-border);
    
    /* Pixel-perfect shadow */
    box-shadow: 
        8px 8px 0 rgba(0, 0, 0, 0.4),
        0 0 60px rgba(0, 0, 0, 0.6);
    
    /* Prevent content overflow */
    overflow: hidden;
    
    /* Positioning context for absolute children */
    position: relative;
}

/* =========================================
   HUD AREA
   ========================================= */

#hud {
    grid-area: hud;
    z-index: var(--z-hud);
}

/* =========================================
   MAIN GAME AREA
   ========================================= */

#game-area {
    grid-area: game;
    
    display: flex;
    justify-content: center;
    align-items: center;
    
    background: var(--color-bg-primary);
    
    /* Inner shadow for depth */
    box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
    
    /* Positioning context for canvas */
    position: relative;
}

/* =========================================
   TIMELINE AREA
   ========================================= */

#timeline {
    grid-area: timeline;
    z-index: var(--z-timeline);
}

/* =========================================
   OVERLAY SYSTEM
   Positioned over entire viewport
   ========================================= */

#overlay-system {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    
    /* Hidden by default */
    pointer-events: none;
    
    /* Layer above everything */
    z-index: var(--z-overlay-backdrop);
}

/* Enable interaction when overlay is active */
#overlay-system.overlay-system--active {
    pointer-events: auto;
}

/* =========================================
   RESPONSIVE: DESKTOP â€“ scale down on smaller screens
   ========================================= */

@media screen and (max-width: 1100px) and (min-width: 900px) {
    #game-container {
        transform: scale(0.9);
        transform-origin: center center;
    }
}

@media screen and (max-width: 1000px) and (min-width: 900px) {
    #game-container {
        transform: scale(0.8);
        transform-origin: center center;
    }
}

@media screen and (max-height: 780px) and (min-width: 900px) {
    #game-container {
        transform: scale(0.85);
        transform-origin: center center;
    }
}

/* =========================================
   RESPONSIVE: MOBILE
   Fullscreen viewport. Virtual controller overlays the game.
   ========================================= */

@media screen and (max-width: 899px),
       (pointer: coarse) {
    html, body {
        height: 100%;
        overflow: hidden;
    }

    body {
        min-height: 100vh;
        min-height: -webkit-fill-available;
    }

    #app {
        width: 100%;
        height: 100vh;
        height: -webkit-fill-available;
        align-items: stretch;
    }

    /* Viewport: fullscreen; controller overlays inside it. */
    #viewport {
        flex: 1 1 auto;
        width: 100vw;
        height: 100vh;
        min-height: 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        overflow: hidden;
        background: var(--color-bg-primary);
        position: relative;
    }

    #game-container {
        transform: none;
        width: 100% !important;
        height: 100% !important;
        max-width: 100%;
        max-height: 100%;
        display: flex !important;
        flex-direction: column;
        align-items: stretch;
        justify-content: stretch;
        grid-template-rows: unset;
        grid-template-areas: unset;
        border: 0;
        box-shadow: none;
    }

    #viewport #hud {
        flex: 0 0 var(--hud-height);
        min-height: 0;
    }

    #game-area {
        flex: 1;
        min-height: 0;
        width: 100%;
        height: 100%;
    }

    /* Timeline visible on mobile (bottom of screen) */
    #viewport #timeline {
        flex: 0 0 var(--timeline-height);
        min-height: 0;
    }

    .canvas-container {
        width: 100% !important;
        height: 100% !important;
        min-height: 0;
        max-width: 100%;
        max-height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #game-canvas {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        max-height: 100% !important;
        aspect-ratio: 16 / 9;
        object-fit: contain;
        object-position: center;
        display: block;
    }

    #controller-area {
        display: none;
    }
}
